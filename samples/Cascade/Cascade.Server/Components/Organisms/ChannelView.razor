@using Cascade.Server.Components.Atoms
@using Cascade.Server.Components.Molecules
@using Cascade.Server.ViewModels
@inherits InletComponent
@* ChannelView.razor - Organism component that owns state and dispatches commands *@

<div class="channel-view">
    <div class="channel-header">
        <h2># @ChannelName</h2>
    </div>

    <div class="channel-content">
        <div class="message-area">
            @if (!string.IsNullOrEmpty(errorMessage))
            {
                <div class="alert alert-danger">@errorMessage</div>
            }
            @if (isLoading)
            {
                <LoadingSpinner Message="Loading messages..."/>
            }
            else if (messages.Count == 0)
            {
                <EmptyState Message="No messages yet. Start the conversation!"/>
            }
            else
            {
                @foreach (MessageViewModel message in messages)
                {
                    <MessageItem
                        Message="@message"
                        IsOwn="@(message.AuthorUserId == Session.UserId)"/>
                }
            }
        </div>

        <MemberList Members="@members"/>
    </div>

    <!-- MessageComposer raises OnSend event, parent handles command dispatch -->
    <MessageComposer OnSend="HandleSendMessageAsync" IsSending="@isSending"/>
</div>