@using Microsoft.AspNetCore.Components.Routing
@using Mississippi.Reservoir.Abstractions
@using Mississippi.Reservoir.Blazor.BuiltIn.Navigation.Actions
@implements IDisposable

@code {

    [Inject]
    private NavigationManager NavigationManager { get; set; } = default!;

    [Inject]
    private IStore Store { get; set; } = default!;

    /// <inheritdoc />
    public void Dispose()
    {
        NavigationManager.LocationChanged -= OnLocationChanged;
        GC.SuppressFinalize(this);
    }

    /// <inheritdoc />
    protected override void OnInitialized()
    {
        base.OnInitialized();

        // Subscribe to location changes
        NavigationManager.LocationChanged += OnLocationChanged;

        // Dispatch initial location
        Store.Dispatch(new LocationChangedAction(NavigationManager.Uri, false));
    }

    private void OnLocationChanged(
        object? sender,
        LocationChangedEventArgs e
    ) =>
        Store.Dispatch(new LocationChangedAction(e.Location, e.IsNavigationIntercepted));

}