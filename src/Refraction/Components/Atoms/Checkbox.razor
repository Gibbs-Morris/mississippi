@namespace Refraction.Components.Atoms

<label class="rf-checkbox rf-checkbox--@Size.ToString().ToLowerInvariant() @(IsChecked ? "rf-checkbox--checked" : "") @(IsIndeterminate ? "rf-checkbox--indeterminate" : "") @(Disabled ? "rf-checkbox--disabled" : "") @Class"
       style="@Style"
       @attributes="AdditionalAttributes">
    <input type="checkbox"
           class="rf-checkbox__input"
           checked="@IsChecked"
           disabled="@Disabled"
           @onchange="OnCheckboxChanged"
           aria-checked="@GetAriaChecked()"
           aria-describedby="@AriaDescribedBy" />
    
    <span class="rf-checkbox__box">
        @if (IsIndeterminate)
        {
            <svg class="rf-checkbox__icon" viewBox="0 0 16 16" fill="none">
                <line x1="4" y1="8" x2="12" y2="8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
        }
        else if (IsChecked)
        {
            <svg class="rf-checkbox__icon" viewBox="0 0 16 16" fill="none">
                <path d="M3 8L6.5 11.5L13 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        }
    </span>
    
    @if (!string.IsNullOrEmpty(Label))
    {
        <span class="rf-checkbox__label">@Label</span>
    }
    @if (ChildContent != null)
    {
        <span class="rf-checkbox__label">@ChildContent</span>
    }
</label>

@code {
    /// <summary>
    /// Gets or sets whether the checkbox is checked.
    /// </summary>
    [Parameter]
    public bool IsChecked { get; set; }

    /// <summary>
    /// Gets or sets the callback when checked state changes.
    /// </summary>
    [Parameter]
    public EventCallback<bool> IsCheckedChanged { get; set; }

    /// <summary>
    /// Gets or sets whether the checkbox is in indeterminate state.
    /// </summary>
    [Parameter]
    public bool IsIndeterminate { get; set; }

    /// <summary>
    /// Gets or sets the label text.
    /// </summary>
    [Parameter]
    public string? Label { get; set; }

    /// <summary>
    /// Gets or sets the size variant.
    /// </summary>
    [Parameter]
    public CheckboxSize Size { get; set; } = CheckboxSize.Medium;

    /// <summary>
    /// Gets or sets whether the checkbox is disabled.
    /// </summary>
    [Parameter]
    public bool Disabled { get; set; }

    /// <summary>
    /// Gets or sets the aria-describedby reference.
    /// </summary>
    [Parameter]
    public string? AriaDescribedBy { get; set; }

    /// <summary>
    /// Gets or sets child content for custom labels.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Gets or sets additional CSS classes.
    /// </summary>
    [Parameter]
    public string? Class { get; set; }

    /// <summary>
    /// Gets or sets inline styles.
    /// </summary>
    [Parameter]
    public string? Style { get; set; }

    /// <summary>
    /// Gets or sets additional attributes.
    /// </summary>
    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private string GetAriaChecked()
    {
        if (IsIndeterminate)
        {
            return "mixed";
        }

        return IsChecked ? "true" : "false";
    }

    private async Task OnCheckboxChanged(ChangeEventArgs e)
    {
        var newValue = (bool)(e.Value ?? false);
        IsChecked = newValue;
        await IsCheckedChanged.InvokeAsync(newValue);
    }
}
