@namespace Refraction.Components.Atoms

<div class="rf-scatter rf-scatter--@Density.ToString().ToLowerInvariant() @(IsPaused ? "rf-scatter--paused" : "") @Class"
     style="@Style"
     aria-hidden="true"
     @attributes="AdditionalAttributes">
    @for (var i = 0; i < ParticleCount; i++)
    {
        <div class="rf-scatter__particle"
             style="--rf-scatter-delay: @(i * 0.5)s; --rf-scatter-x: @GetParticleX(i)%; --rf-scatter-y: @GetParticleY(i)%; --rf-scatter-size: @GetParticleSize(i)px;"></div>
    }
</div>

@code {
    /// <summary>
    /// Gets or sets the particle density.
    /// </summary>
    [Parameter]
    public ScatterDensity Density { get; set; } = ScatterDensity.Medium;

    /// <summary>
    /// Gets or sets whether the animation is paused.
    /// </summary>
    [Parameter]
    public bool IsPaused { get; set; }

    /// <summary>
    /// Gets or sets additional CSS classes.
    /// </summary>
    [Parameter]
    public string? Class { get; set; }

    /// <summary>
    /// Gets or sets inline styles.
    /// </summary>
    [Parameter]
    public string? Style { get; set; }

    /// <summary>
    /// Gets or sets additional attributes.
    /// </summary>
    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private int ParticleCount => Density switch
    {
        ScatterDensity.Light => 10,
        ScatterDensity.Medium => 20,
        ScatterDensity.Heavy => 40,
        _ => 20,
    };

    // Deterministic particle positioning using hash-based distribution
    private static int GetParticleX(int index) => (index * 73) % 100;
    private static int GetParticleY(int index) => (index * 47 + 17) % 100;
    private static int GetParticleSize(int index) => 2 + (index % 3);
}
